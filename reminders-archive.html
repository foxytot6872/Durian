<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reminders Archive - Durian Dashboard</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/dashboard.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    .archive-container { max-width: 960px; margin: 2rem auto; padding: 1rem; }
    .archive-list { background: #fff; border-radius: 8px; padding: 1rem; box-shadow: 0 2px 10px rgba(2,6,23,0.06); }
    .archive-item { display:flex; align-items:center; justify-content:space-between; padding:0.6rem 0; border-bottom:1px solid #eef4fb; }
    .archive-actions button { margin-left:0.5rem; }
    .topbar { display:flex; justify-content:space-between; align-items:center; gap:1rem; margin-bottom:1rem; }
  </style>
</head>
<body>
  <div class="archive-container">
    <div class="topbar">
      <div style="display:flex;align-items:center;gap:0.75rem;">
        <a href="today's recommendation.html" class="nav-link" style="text-decoration:none;color:inherit;"><i class="fas fa-chevron-left"></i> Back</a>
        <h2 style="margin:0;">Reminders Archive</h2>
      </div>
      <div>
        <a href="#" id="restoreAllBtn" class="btn-secondary" style="padding:0.45rem 0.75rem; border-radius:6px; text-decoration:none;">Restore All</a>

        <a href="#" id="clearAllBtn"  class="btn-secondary" style="padding:0.45rem 0.75rem;  border-radius:6px; background:#4ba252; color:white; text-decoration:none; ">Clear Archive</a>
      </div>
    </div>

    <div class="archive-list" id="archiveList">
      <p style="margin:0; color:#64748b;">Loading archived reminders...</p>
    </div>
  </div>

  <script>
    (function(){
      const ARCHIVE_KEY = 'farmRemindersArchived';
      const REMINDERS_KEY = 'farmReminders';

      function loadArchive(){
        try{ const raw = localStorage.getItem(ARCHIVE_KEY); return raw? JSON.parse(raw): []; }catch(e){return []}
      }
      function saveArchive(list){ localStorage.setItem(ARCHIVE_KEY, JSON.stringify(list)); }
      function loadReminders(){ try{ const raw = localStorage.getItem(REMINDERS_KEY); return raw? JSON.parse(raw): []; }catch(e){return []} }
      function saveReminders(list){ localStorage.setItem(REMINDERS_KEY, JSON.stringify(list)); }

      function formatLocal(dtStr){ const d = new Date(dtStr); return d.toLocaleString(); }

      function render(){
        const list = loadArchive();
        const container = document.getElementById('archiveList');
        if(!container) return;
        if(!list.length){ container.innerHTML = '<p style="margin:0;color:#64748b;">No archived reminders.</p>'; return; }

        container.innerHTML = list.map(item => {
          const title = (item.title||'Reminder').replace(/&/g,'&amp;');
          const notes = (item.notes||'').replace(/&/g,'&amp;');
          const dt = formatLocal(item.datetime);
          return `
            <div class="archive-item" data-id="${item.id}">
              <div style="flex:1">
                <div style="font-weight:600;color:#0f172a;">${title}</div>
                <div style="font-size:0.9rem;color:#475569;">${dt}</div>
                <div style="font-size:0.9rem;color:#64748b;margin-top:0.25rem;">${notes}</div>
              </div>
              <div class="archive-actions">
                <button class="btn-secondary btn-restore" data-id="${item.id}">Restore</button>
                <button class="btn-secondary btn-delete" data-id="${item.id}">Delete</button>
              </div>
            </div>
          `;
        }).join('');

        container.querySelectorAll('.btn-restore').forEach(b => b.addEventListener('click', ()=>{
          const id = b.getAttribute('data-id'); restoreOne(id);
        }));
        container.querySelectorAll('.btn-delete').forEach(b => b.addEventListener('click', ()=>{
          const id = b.getAttribute('data-id'); deleteOne(id);
        }));
      }

      function restoreOne(id){
        const arch = loadArchive();
        const idx = arch.findIndex(x=>x.id===id); if(idx===-1) return;
        const [item] = arch.splice(idx,1);
        const reminders = loadReminders(); reminders.push(item); saveReminders(reminders); saveArchive(arch); render();
      }

      function deleteOne(id){
        const arch = loadArchive(); const remaining = arch.filter(x=>x.id!==id); saveArchive(remaining); render();
      }

      function restoreAll(){ const arch = loadArchive(); if(!arch.length) return; const reminders = loadReminders(); const merged = reminders.concat(arch); saveReminders(merged); saveArchive([]); render(); }
      function clearAll(){ if(!confirm('Permanently delete all archived reminders?')) return; saveArchive([]); render(); }

      document.addEventListener('DOMContentLoaded', ()=>{
        document.getElementById('restoreAllBtn').addEventListener('click', restoreAll);
        document.getElementById('clearAllBtn').addEventListener('click', clearAll);
        render();
      });

      // expose for debug
      window._archiveHelpers = { loadArchive, loadReminders };
    })();
  </script>
</body>
</html>
